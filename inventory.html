<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChefOS Stock - Inventory Management</title>
  <meta name="description" content="Restaurant Inventory Management System by ChefOS">
  <link rel="stylesheet" href="assets/css/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div class="app-container">
  <!-- SIDEBAR -->
  <aside class="sidebar" aria-label="Main navigation">
    <div class="sidebar-header">
      <h1><i class="fas fa-warehouse" aria-hidden="true"></i> ChefOS Stock</h1>
    </div>
    
    <nav class="sidebar-nav" aria-label="Primary navigation">
      <div class="nav-section">
        <h2 class="visually-hidden">Main Menu</h2>
        <h3>Menu</h3>
        <ul class="nav-links">
          <li><a href="pos.html"><i class="fas fa-cash-register" aria-hidden="true"></i> POS</a></li>
          <li><a href="orders.html"><i class="fas fa-list" aria-hidden="true"></i> Orders</a></li>
          <li><a href="kds.html"><i class="fas fa-utensils" aria-hidden="true"></i> ChefOS Line</a></li>
        </ul>
      </div>
      
      <div class="nav-section">
        <h3>Management</h3>
        <ul class="nav-links">
          <li><a href="inventory.html" class="active" aria-current="page"><i class="fas fa-boxes" aria-hidden="true"></i> ChefOS Stock</a></li>
          <li><a href="reports.html"><i class="fas fa-chart-bar" aria-hidden="true"></i> ChefOS Insights</a></li>
          <li><a href="settings.html"><i class="fas fa-cog" aria-hidden="true"></i> Settings</a></li>
        </ul>
      </div>
    </nav>
    
    <!-- SETTINGS PANEL -->
    <div class="settings-panel" role="region" aria-label="Theme settings">
      <div class="theme-toggle">
        <span><i class="fas fa-moon" aria-hidden="true"></i> Dark Mode</span>
        <label class="toggle-switch">
          <input type="checkbox" id="themeToggle" aria-label="Toggle dark mode">
          <span class="toggle-slider" aria-hidden="true"></span>
        </label>
      </div>
    </div>
    
    <!-- HELP CENTER -->
    <section class="help-center" aria-label="Help and support">
      <h3><i class="fas fa-life-ring" aria-hidden="true"></i> Help Center</h3>
      <div class="contact-info">
        <a href="mailto:dereck@dereckmungoriwo.online">
          <i class="fas fa-envelope" aria-hidden="true"></i> dereck@dereckmungoriwo.online
        </a>
        <a href="https://wa.me/27717184048" target="_blank" rel="noopener noreferrer">
          <i class="fab fa-whatsapp" aria-hidden="true"></i> +27 71 718 4048
        </a>
        <div>
          <i class="fas fa-clock" aria-hidden="true"></i> 24/7 Support
        </div>
      </div>
    </section>
    
    <a href="login.html" class="logout-btn">
      <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout
    </a>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <!-- TOP BAR - MATCHING POS PAGE STRUCTURE -->
      <header class="top-bar" role="banner">
  <div class="header-left">
    <h1 class="app-title">ChefOS Orders Management</h1>
    <p class="header-motto">Tracking • Control • Analytics</p>
  </div>

  <!-- TRUE CENTER COLUMN -->
  <div class="header-center">
    <div class="time-display" aria-live="polite">
      <svg class="clock-icon" viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none"/>
        <path d="M12 7v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <time id="clockText">Loading time...</time>
    </div>
  </div>

  <div class="header-right">
    <div class="user-info">
      <div class="user-avatar">DM</div>
      <div class="user-meta">
        <div class="user-name">Dereck Mungoriwo</div>
        <div class="user-role">Manager</div>
      </div>
    </div>
  </div>
</header>

    <!-- INVENTORY CONTAINER -->
    <main class="inventory-container" id="main-content">
      <div class="inventory-header">
        <h2><i class="fas fa-boxes" aria-hidden="true"></i> Inventory Management</h2>
        <div class="inventory-actions">
          <button class="action-btn add-btn" id="addItemBtn" aria-label="Add new item">
            <i class="fas fa-plus" aria-hidden="true"></i> Add Item
          </button>
          <button class="action-btn refresh-btn" id="refreshBtn" aria-label="Refresh inventory">
            <i class="fas fa-sync-alt" aria-hidden="true"></i> Refresh
          </button>
          <button class="action-btn restock-btn" id="lowStockBtn" aria-label="Show low stock items">
            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i> Low Stock
          </button>
        </div>
      </div>

      <!-- INVENTORY STATS -->
      <div class="inventory-stats">
        <div class="stat-card" role="region" aria-label="Total items">
          <div class="stat-icon" style="background: #28a745;">
            <i class="fas fa-check-circle" aria-hidden="true"></i>
          </div>
          <div class="stat-info">
            <h3 id="totalItems">0</h3>
            <p>Total Items</p>
          </div>
        </div>
        
        <div class="stat-card" role="region" aria-label="Low stock items">
          <div class="stat-icon" style="background: #ffc107;">
            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
          </div>
          <div class="stat-info">
            <h3 id="lowStockItems">0</h3>
            <p>Low Stock</p>
          </div>
        </div>
        
        <div class="stat-card" role="region" aria-label="Out of stock items">
          <div class="stat-icon" style="background: #e74c3c;">
            <i class="fas fa-times-circle" aria-hidden="true"></i>
          </div>
          <div class="stat-info">
            <h3 id="outOfStockItems">0</h3>
            <p>Out of Stock</p>
          </div>
        </div>
        
        <div class="stat-card" role="region" aria-label="Items needing restock">
          <div class="stat-icon" style="background: #007bff;">
            <i class="fas fa-truck" aria-hidden="true"></i>
          </div>
          <div class="stat-info">
            <h3 id="needRestock">0</h3>
            <p>Need Restock</p>
          </div>
        </div>
      </div>

      <!-- INVENTORY FILTERS -->
      <section class="inventory-filters" aria-label="Inventory filters">
        <div class="search-box">
          <i class="fas fa-search" aria-hidden="true"></i>
          <input type="text" id="searchInput" placeholder="Search inventory items..." aria-label="Search inventory">
        </div>
        <div class="filter-options">
          <select id="categoryFilter" aria-label="Filter by category">
            <option value="all">All Categories</option>
            <option value="breakfast">Breakfast</option>
            <option value="main">Main Course</option>
            <option value="salads">Salads</option>
            <option value="desserts">Desserts</option>
            <option value="ingredients">Ingredients</option>
          </select>
          <select id="stockFilter" aria-label="Filter by stock level">
            <option value="all">All Stock Levels</option>
            <option value="low">Low Stock</option>
            <option value="out">Out of Stock</option>
            <option value="good">Good Stock</option>
          </select>
        </div>
      </section>

      <!-- INVENTORY TABLE -->
      <div class="inventory-table-container">
        <table class="inventory-table" aria-label="Inventory items">
          <thead>
            <tr>
              <th scope="col">Item Name</th>
              <th scope="col">Category</th>
              <th scope="col">Current Stock</th>
              <th scope="col">Min Stock</th>
              <th scope="col">Status</th>
              <th scope="col">Last Updated</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="inventory-list">
            <!-- Inventory items will be loaded here -->
          </tbody>
        </table>
        
        <div id="no-inventory" style="display: none; text-align: center; padding: 40px;" aria-live="polite">
          <i class="fas fa-box-open fa-3x" style="color: var(--gray);" aria-hidden="true"></i>
          <h3 style="margin: 20px 0 10px; color: var(--gray);">No Inventory Items</h3>
          <p style="color: var(--gray);">Add items to manage your inventory.</p>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- ADD/EDIT ITEM MODAL -->
<div id="itemModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="inventoryForm">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Add New Item</h3>
      <button class="modal-close" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="inventoryForm">
        <input type="hidden" id="editItemId">
        
        <div class="form-group">
          <label for="itemName">Item Name *</label>
          <input type="text" id="itemName" required placeholder="e.g., Flour, Eggs, Beef" aria-required="true">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="itemCategory">Category *</label>
            <select id="itemCategory" required aria-required="true">
              <option value="">Select Category</option>
              <option value="breakfast">Breakfast</option>
              <option value="main">Main Course</option>
              <option value="salads">Salads</option>
              <option value="desserts">Desserts</option>
              <option value="ingredients">Ingredients</option>
              <option value="beverages">Beverages</option>
              <option value="dairy">Dairy</option>
              <option value="produce">Produce</option>
              <option value="meat">Meat & Poultry</option>
              <option value="seafood">Seafood</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="itemUnit">Unit</label>
            <select id="itemUnit">
              <option value="kg">Kilograms (kg)</option>
              <option value="g">Grams (g)</option>
              <option value="lbs">Pounds (lbs)</option>
              <option value="oz">Ounces (oz)</option>
              <option value="L">Liters (L)</option>
              <option value="ml">Milliliters (ml)</option>
              <option value="pcs">Pieces</option>
              <option value="box">Box</option>
              <option value="bottle">Bottle</option>
              <option value="can">Can</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="currentStock">Current Stock *</label>
            <input type="number" id="currentStock" required min="0" step="0.01" placeholder="0" aria-required="true">
          </div>
          
          <div class="form-group">
            <label for="minStock">Minimum Stock *</label>
            <input type="number" id="minStock" required min="0" step="0.01" placeholder="10" aria-required="true">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="supplier">Supplier</label>
            <input type="text" id="supplier" placeholder="Supplier name">
          </div>
          
          <div class="form-group">
            <label for="cost">Cost per Unit</label>
            <input type="number" id="cost" min="0" step="0.01" placeholder="0.00">
          </div>
        </div>
        
        <div class="form-group">
          <label for="itemNotes">Notes</label>
          <textarea id="itemNotes" rows="3" placeholder="Additional notes about this item..."></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary modal-close">Cancel</button>
      <button class="btn btn-primary" id="saveItemBtn">Save Item</button>
    </div>
  </div>
</div>

<!-- RESTOCK MODAL -->
<div id="restockModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="restockModalTitle">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="restockModalTitle"><i class="fas fa-truck" aria-hidden="true"></i> Restock Item</h3>
      <button class="modal-close" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="restockForm">
        <input type="hidden" id="restockItemId">
        
        <div class="restock-info">
          <h4 id="restockItemName"></h4>
          <p>Current Stock: <span id="restockCurrent"></span></p>
          <p>Minimum Stock: <span id="restockMin"></span></p>
        </div>
        
        <div class="form-group">
          <label for="restockQuantity">Quantity to Add *</label>
          <input type="number" id="restockQuantity" required min="1" step="0.01" placeholder="Enter quantity" aria-required="true">
        </div>
        
        <div class="form-group">
          <label for="restockNotes">Restock Notes</label>
          <textarea id="restockNotes" rows="2" placeholder="Notes about this restock..."></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary modal-close">Cancel</button>
      <button class="btn btn-success" id="confirmRestockBtn">Confirm Restock</button>
    </div>
  </div>
</div>

<script src="assets/js/menuItems.js"></script>
<script>
  // DOM Elements
  const inventoryList = document.getElementById('inventory-list');
  const noInventoryMessage = document.getElementById('no-inventory');
  const searchInput = document.getElementById('searchInput');
  const categoryFilter = document.getElementById('categoryFilter');
  const stockFilter = document.getElementById('stockFilter');
  const refreshBtn = document.getElementById('refreshBtn');
  const addItemBtn = document.getElementById('addItemBtn');
  const lowStockBtn = document.getElementById('lowStockBtn');
  
  // Statistics elements
  const totalItemsEl = document.getElementById('totalItems');
  const lowStockItemsEl = document.getElementById('lowStockItems');
  const outOfStockItemsEl = document.getElementById('outOfStockItems');
  const needRestockEl = document.getElementById('needRestock');
  
  // Modal elements
  const itemModal = document.getElementById('itemModal');
  const restockModal = document.getElementById('restockModal');
  const modalCloseButtons = document.querySelectorAll('.modal-close');
  
  // Form elements
  const inventoryForm = document.getElementById('inventoryForm');
  const saveItemBtn = document.getElementById('saveItemBtn');
  const confirmRestockBtn = document.getElementById('confirmRestockBtn');
  
  // Current state
  let inventoryData = [];
  let currentItemId = null;
  
  function loadInventory() {
    inventoryData = JSON.parse(localStorage.getItem('chefos_inventory_detailed')) || [];
    
    if (inventoryData.length === 0) {
      initializeInventory();
    }
    
    applyFilters();
    updateInventoryStats();
  }
  
  function initializeInventory() {
    const allIngredients = new Set();
    
    if (typeof menuItems !== 'undefined') {
      menuItems.forEach(item => {
        Object.keys(item.ingredients).forEach(ingredient => {
          allIngredients.add(ingredient);
        });
      });
      
      inventoryData = Array.from(allIngredients).map(ingredient => ({
        id: Date.now() + Math.random(),
        name: ingredient.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
        category: getIngredientCategory(ingredient),
        currentStock: 20,
        minStock: 5,
        unit: 'pcs',
        supplier: '',
        cost: 0,
        notes: '',
        lastUpdated: new Date().toISOString(),
        history: []
      }));
    } else {
      inventoryData = [
        {
          id: 1,
          name: 'Flour',
          category: 'ingredients',
          currentStock: 20,
          minStock: 5,
          unit: 'kg',
          supplier: 'Bakery Supplies Co',
          cost: 2.5,
          notes: 'All-purpose flour',
          lastUpdated: new Date().toISOString(),
          history: []
        },
        {
          id: 2,
          name: 'Eggs',
          category: 'breakfast',
          currentStock: 30,
          minStock: 10,
          unit: 'pcs',
          supplier: 'Fresh Farms',
          cost: 0.25,
          notes: 'Large eggs',
          lastUpdated: new Date().toISOString(),
          history: []
        },
        {
          id: 3,
          name: 'Beef Patty',
          category: 'meat',
          currentStock: 15,
          minStock: 5,
          unit: 'pcs',
          supplier: 'Quality Meats',
          cost: 3.5,
          notes: '80/20 beef patties',
          lastUpdated: new Date().toISOString(),
          history: []
        }
      ];
    }
    
    saveInventory();
  }
  
  function getIngredientCategory(ingredient) {
    const categories = {
      'flour': 'ingredients', 'eggs': 'breakfast', 'milk': 'dairy',
      'butter': 'dairy', 'bacon': 'meat', 'bread': 'ingredients',
      'beef_patty': 'meat', 'chicken': 'meat', 'salmon': 'seafood',
      'pasta': 'ingredients', 'potato': 'produce',
      'default': 'ingredients'
    };
    return categories[ingredient] || 'ingredients';
  }
  
  function saveInventory() {
    localStorage.setItem('chefos_inventory_detailed', JSON.stringify(inventoryData));
  }
  
  function applyFilters() {
    const searchTerm = searchInput.value.toLowerCase();
    const category = categoryFilter.value;
    const stockLevel = stockFilter.value;
    
    let filteredItems = inventoryData.filter(item => {
      if (searchTerm && !item.name.toLowerCase().includes(searchTerm)) return false;
      if (category !== 'all' && item.category !== category) return false;
      
      if (stockLevel !== 'all') {
        const stockStatus = getStockStatus(item);
        if (stockLevel === 'low' && stockStatus !== 'low') return false;
        if (stockLevel === 'out' && stockStatus !== 'out') return false;
        if (stockLevel === 'good' && stockStatus !== 'good') return false;
      }
      
      return true;
    });
    
    filteredItems.sort((a, b) => {
      const statusA = getStockStatus(a);
      const statusB = getStockStatus(b);
      const statusOrder = { 'out': 0, 'low': 1, 'good': 2 };
      return statusOrder[statusA] - statusOrder[statusB];
    });
    
    renderInventoryTable(filteredItems);
  }
  
  function getStockStatus(item) {
    if (item.currentStock <= 0) return 'out';
    if (item.currentStock <= item.minStock) return 'low';
    return 'good';
  }
  
  function renderInventoryTable(items) {
    inventoryList.innerHTML = '';
    
    if (items.length === 0) {
      noInventoryMessage.style.display = 'block';
    } else {
      noInventoryMessage.style.display = 'none';
      
      items.forEach(item => {
        const row = document.createElement('tr');
        const stockStatus = getStockStatus(item);
        
        const lastUpdated = new Date(item.lastUpdated);
        const dateString = lastUpdated.toLocaleDateString();
        const timeString = lastUpdated.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        let statusBadge = '';
        switch(stockStatus) {
          case 'good':
            statusBadge = '<span class="status-badge" style="background: #28a745;">Good</span>';
            break;
          case 'low':
            statusBadge = '<span class="status-badge" style="background: #ffc107;">Low</span>';
            break;
          case 'out':
            statusBadge = '<span class="status-badge" style="background: #e74c3c;">Out</span>';
            break;
        }
        
        const stockIndicator = `
          <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 100px; height: 8px; background: var(--gray-light); border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; width: ${Math.min(100, (item.currentStock / (item.minStock * 3)) * 100)}%; 
                background: ${stockStatus === 'good' ? '#28a745' : stockStatus === 'low' ? '#ffc107' : '#e74c3c'};">
              </div>
            </div>
            <span>${item.currentStock} ${item.unit}</span>
          </div>
        `;
        
        row.innerHTML = `
          <td><strong>${item.name}</strong></td>
          <td><span class="category-tag">${item.category}</span></td>
          <td>${stockIndicator}</td>
          <td>${item.minStock} ${item.unit}</td>
          <td>${statusBadge}</td>
          <td>${dateString}<br><small>${timeString}</small></td>
          <td>
            <div class="action-buttons">
              <button class="action-btn edit-btn" data-id="${item.id}" aria-label="Edit ${item.name}">
                <i class="fas fa-edit" aria-hidden="true"></i>
              </button>
              <button class="action-btn restock-action-btn" data-id="${item.id}" aria-label="Restock ${item.name}">
                <i class="fas fa-truck" aria-hidden="true"></i>
              </button>
              <button class="action-btn delete-btn" data-id="${item.id}" aria-label="Delete ${item.name}">
                <i class="fas fa-trash" aria-hidden="true"></i>
              </button>
            </div>
          </td>
        `;
        
        inventoryList.appendChild(row);
      });
      
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => editItem(parseFloat(btn.getAttribute('data-id'))));
      });
      
      document.querySelectorAll('.restock-action-btn').forEach(btn => {
        btn.addEventListener('click', () => openRestockModal(parseFloat(btn.getAttribute('data-id'))));
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => deleteItem(parseFloat(btn.getAttribute('data-id'))));
      });
    }
  }
  
  function updateInventoryStats() {
    let total = inventoryData.length;
    let low = 0;
    let out = 0;
    let needRestock = 0;
    
    inventoryData.forEach(item => {
      const status = getStockStatus(item);
      if (status === 'low') low++;
      if (status === 'out') out++;
      if (status === 'low' || status === 'out') needRestock++;
    });
    
    totalItemsEl.textContent = total;
    lowStockItemsEl.textContent = low;
    outOfStockItemsEl.textContent = out;
    needRestockEl.textContent = needRestock;
  }
  
  function addNewItem() {
    inventoryForm.reset();
    document.getElementById('modalTitle').textContent = 'Add New Item';
    document.getElementById('editItemId').value = '';
    currentItemId = null;
    itemModal.style.display = 'flex';
    document.getElementById('itemName').focus();
  }
  
  function editItem(itemId) {
    const item = inventoryData.find(i => i.id === itemId);
    if (!item) return;
    
    document.getElementById('modalTitle').textContent = 'Edit Item';
    document.getElementById('editItemId').value = item.id;
    document.getElementById('itemName').value = item.name;
    document.getElementById('itemCategory').value = item.category;
    document.getElementById('itemUnit').value = item.unit;
    document.getElementById('currentStock').value = item.currentStock;
    document.getElementById('minStock').value = item.minStock;
    document.getElementById('supplier').value = item.supplier || '';
    document.getElementById('cost').value = item.cost || '';
    document.getElementById('itemNotes').value = item.notes || '';
    
    currentItemId = itemId;
    itemModal.style.display = 'flex';
    document.getElementById('itemName').focus();
  }
  
  function saveItem() {
    if (!inventoryForm.checkValidity()) {
      inventoryForm.reportValidity();
      return;
    }
    
    const itemData = {
      id: currentItemId || Date.now(),
      name: document.getElementById('itemName').value,
      category: document.getElementById('itemCategory').value,
      unit: document.getElementById('itemUnit').value,
      currentStock: parseFloat(document.getElementById('currentStock').value),
      minStock: parseFloat(document.getElementById('minStock').value),
      supplier: document.getElementById('supplier').value,
      cost: parseFloat(document.getElementById('cost').value) || 0,
      notes: document.getElementById('itemNotes').value,
      lastUpdated: new Date().toISOString(),
      history: []
    };
    
    if (currentItemId) {
      const index = inventoryData.findIndex(i => i.id === currentItemId);
      if (index !== -1) {
        itemData.history = inventoryData[index].history;
        inventoryData[index] = itemData;
      }
    } else {
      inventoryData.push(itemData);
    }
    
    saveInventory();
    loadInventory();
    itemModal.style.display = 'none';
    alert(`Item "${itemData.name}" saved successfully!`);
  }
  
  function deleteItem(itemId) {
    if (!confirm('Are you sure you want to delete this item?')) return;
    
    inventoryData = inventoryData.filter(i => i.id !== itemId);
    saveInventory();
    loadInventory();
    alert('Item deleted successfully!');
  }
  
  function openRestockModal(itemId) {
    const item = inventoryData.find(i => i.id === itemId);
    if (!item) return;
    
    document.getElementById('restockItemId').value = item.id;
    document.getElementById('restockItemName').textContent = item.name;
    document.getElementById('restockCurrent').textContent = `${item.currentStock} ${item.unit}`;
    document.getElementById('restockMin').textContent = `${item.minStock} ${item.unit}`;
    document.getElementById('restockQuantity').value = '';
    document.getElementById('restockNotes').value = '';
    
    restockModal.style.display = 'flex';
    document.getElementById('restockQuantity').focus();
  }
  
  function confirmRestock() {
    const itemId = parseFloat(document.getElementById('restockItemId').value);
    const quantity = parseFloat(document.getElementById('restockQuantity').value);
    const notes = document.getElementById('restockNotes').value;
    
    if (!quantity || quantity <= 0) {
      alert('Please enter a valid quantity.');
      return;
    }
    
    const itemIndex = inventoryData.findIndex(i => i.id === itemId);
    if (itemIndex === -1) return;
    
    const oldStock = inventoryData[itemIndex].currentStock;
    inventoryData[itemIndex].currentStock += quantity;
    inventoryData[itemIndex].lastUpdated = new Date().toISOString();
    
    inventoryData[itemIndex].history.push({
      date: new Date().toISOString(),
      action: 'restock',
      quantity: quantity,
      oldStock: oldStock,
      newStock: inventoryData[itemIndex].currentStock,
      notes: notes
    });
    
    saveInventory();
    loadInventory();
    restockModal.style.display = 'none';
    
    alert(`Restocked ${quantity} ${inventoryData[itemIndex].unit} of "${inventoryData[itemIndex].name}"`);
  }
  
  function showLowStock() {
    stockFilter.value = 'low';
    applyFilters();
  }
  
  // Time Display Function - Matching POS Page
  function updateTime() {
    const now = new Date();
    const dateTimeString = now.toISOString();
    const formattedDate = now.toLocaleString('en-US', { 
      weekday: 'short',
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    });
    
    const clockText = document.getElementById('clockText');
    if (clockText) {
      clockText.textContent = formattedDate;
      clockText.setAttribute('datetime', dateTimeString);
    }
  }
  
  // Theme Toggle
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.getElementById('themeToggle');
    
    // Check for saved theme
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-theme');
      if (themeToggle) themeToggle.checked = true;
    }
    
    // Theme toggle event
    if (themeToggle) {
      themeToggle.addEventListener('change', function() {
        if (this.checked) {
          document.body.classList.add('dark-theme');
          localStorage.setItem('theme', 'dark');
        } else {
          document.body.classList.remove('dark-theme');
          localStorage.setItem('theme', 'light');
        }
      });
    }
    
    // Initialize inventory and time
    loadInventory();
    updateTime();
    setInterval(loadInventory, 30000);
    setInterval(updateTime, 1000);
    
    // Event Listeners
    searchInput.addEventListener('input', applyFilters);
    categoryFilter.addEventListener('change', applyFilters);
    stockFilter.addEventListener('change', applyFilters);
    
    refreshBtn.addEventListener('click', loadInventory);
    addItemBtn.addEventListener('click', addNewItem);
    lowStockBtn.addEventListener('click', showLowStock);
    
    saveItemBtn.addEventListener('click', saveItem);
    confirmRestockBtn.addEventListener('click', confirmRestock);
    
    modalCloseButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        itemModal.style.display = 'none';
        restockModal.style.display = 'none';
      });
    });
    
    window.addEventListener('click', (event) => {
      if (event.target === itemModal) itemModal.style.display = 'none';
      if (event.target === restockModal) restockModal.style.display = 'none';
    });
    
    // Keyboard navigation for modals
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        itemModal.style.display = 'none';
        restockModal.style.display = 'none';
      }
    });
  });
  
  // Add visually hidden CSS
  const style = document.createElement('style');
  style.textContent = `
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Dark theme adjustments */
    .dark-theme .inventory-stats,
    .dark-theme .inventory-filters,
    .dark-theme .inventory-table-container,
    .dark-theme .modal-content {
      background: #2d3748;
      border-color: #4a5568;
    }
    
    .dark-theme input,
    .dark-theme select,
    .dark-theme textarea {
      background: #4a5568;
      color: #fff;
      border-color: #718096;
    }
    
    .dark-theme .inventory-table th {
      background: #4a5568;
    }
    
    .dark-theme .stat-card {
      background: #4a5568;
      border-color: #718096;
    }
  `;
  document.head.appendChild(style);
</script>

<style>
  /* All your existing CSS styles remain exactly the same */
  .inventory-container {
    padding: 20px;
    max-height: calc(100vh - 75px);
    overflow-y: auto;
  }
  
  .inventory-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
  }
  
  .inventory-header h2 {
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0;
  }
  
  .inventory-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .action-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .add-btn {
    background: var(--primary);
    color: white;
  }
  
  .refresh-btn {
    background: #6c757d;
    color: white;
  }
  
  .restock-btn {
    background: #ffc107;
    color: #212529;
  }
  
  .action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }
  
  .inventory-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: var(--white);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
  }
  
  .stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
  }
  
  .stat-info h3 {
    margin: 0;
    font-size: 24px;
    color: var(--dark);
  }
  
  .stat-info p {
    margin: 5px 0 0 0;
    color: var(--gray);
    font-size: 14px;
  }
  
  .inventory-filters {
    background: var(--white);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
  }
  
  .search-box {
    flex: 1;
    min-width: 300px;
    position: relative;
  }
  
  .search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
  }
  
  .search-box input {
    width: 100%;
    padding: 12px 12px 12px 45px;
    border: 1px solid var(--gray-light);
    border-radius: 8px;
    font-size: 14px;
    background: var(--white);
    color: var(--dark);
  }
  
  .filter-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .filter-options select {
    padding: 10px 15px;
    border: 1px solid var(--gray-light);
    border-radius: 8px;
    background: var(--white);
    color: var(--dark);
    font-size: 14px;
    min-width: 150px;
  }
  
  .inventory-table-container {
    background: var(--white);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
    overflow-x: auto;
  }
  
  .inventory-table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .inventory-table th {
    background: var(--primary);
    color: white;
    padding: 18px 15px;
    text-align: left;
    font-weight: 600;
    font-size: 14px;
  }
  
  .inventory-table td {
    padding: 15px;
    border-bottom: 1px solid var(--gray-light);
    vertical-align: middle;
  }
  
  .inventory-table tr:hover {
    background: var(--light);
  }
  
  .inventory-table tr:last-child td {
    border-bottom: none;
  }
  
  .category-tag {
    display: inline-block;
    padding: 5px 12px;
    background: var(--light);
    color: var(--dark);
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }
  
  .action-buttons {
    display: flex;
    gap: 5px;
  }
  
  .action-buttons .action-btn {
    padding: 8px 12px;
    font-size: 14px;
  }
  
  .edit-btn {
    background: #007bff;
    color: white;
  }
  
  .restock-action-btn {
    background: #28a745;
    color: white;
  }
  
  .delete-btn {
    background: #e74c3c;
    color: white;
  }
  
  /* FORM STYLES */
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark);
  }
  
  input, select, textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--gray-light);
    border-radius: 8px;
    font-size: 14px;
    background: var(--white);
    color: var(--dark);
    transition: border-color 0.2s;
  }
  
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary);
  }
  
  textarea {
    resize: vertical;
  }
  
  /* RESTOCK INFO */
  .restock-info {
    background: var(--light);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
  }
  
  .restock-info h4 {
    margin: 0 0 10px 0;
    color: var(--primary);
  }
  
  .restock-info p {
    margin: 5px 0;
    color: var(--dark);
  }
  
  /* MODAL STYLES */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  
  .modal-content {
    background: var(--white);
    border-radius: 15px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  
  .modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--gray-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .modal-header h3 {
    margin: 0;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--gray);
  }
  
  .modal-body {
    padding: 20px;
  }
  
  .modal-footer {
    padding: 20px;
    border-top: 1px solid var(--gray-light);
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }
  
  .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition);
  }
  
  .btn-primary {
    background: var(--primary);
    color: white;
  }
  
  .btn-secondary {
    background: var(--gray-light);
    color: var(--dark);
  }
  
  .btn-success {
    background: #28a745;
    color: white;
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }
  
  /* RESPONSIVE */
  @media (max-width: 768px) {
    .inventory-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .inventory-actions {
      width: 100%;
    }
    
    .inventory-filters {
      flex-direction: column;
      align-items: stretch;
    }
    
    .search-box {
      min-width: 100%;
    }
    
    .filter-options {
      flex-direction: column;
    }
    
    .filter-options select {
      min-width: 100%;
    }
    
    .form-row {
      grid-template-columns: 1fr;
      gap: 0;
    }
    
    .inventory-table {
      min-width: 900px;
    }
    
    .modal-content {
      width: 95%;
      margin: 10px;
    }
  }
  
  @media (max-width: 480px) {
    .action-btn {
      padding: 8px 15px;
      font-size: 14px;
    }
    
    .inventory-stats {
      grid-template-columns: 1fr;
    }
  }
</style>
</body>
</html>
